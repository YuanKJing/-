<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ¸ æ·‡æ·‡ä¸åŠ ç›å®è´çš„å°çº¢èŠ±ä»“åº“ ğŸŒ¸</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --main-pink: #ffafbd;
            --soft-orange: #ffc3a0;
            --dark-pink: #ff6b81;
            --bg-pink: #fff5f7;
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background-color: var(--bg-pink);
            background-image: radial-gradient(#ffcad4 0.5px, transparent 0.5px);
            background-size: 20px 20px;
            color: #4a4a4a;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 600px;
        }

        /* é¡¶éƒ¨çœ‹æ¿ */
        .header-card {
            background: white;
            border-radius: 30px;
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(255, 175, 189, 0.4);
            margin-bottom: 25px;
            position: relative;
            border: 3px solid var(--main-pink);
        }

        .main-flower-img {
            font-size: 60px;
            margin-bottom: 10px;
            display: block;
            animation: floating 3s ease-in-out infinite;
        }

        .title {
            color: var(--dark-pink);
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .level-title {
            display: inline-block;
            background: linear-gradient(135deg, #fff0f3, #ffe0e6);
            color: var(--dark-pink);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .flower-display {
            display: flex;
            justify-content: center;
            align-items: baseline;
            margin: 10px 0;
        }

        .flower-count {
            font-size: 5rem;
            font-weight: 900;
            color: var(--dark-pink);
            text-shadow: 3px 3px 0px #ffe0e6;
        }

        .flower-unit {
            font-size: 1.2rem;
            color: var(--main-pink);
            margin-left: 10px;
            font-weight: bold;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 15px;
        }

        .btn-add {
            background: linear-gradient(135deg, var(--main-pink), var(--dark-pink));
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 107, 129, 0.3);
        }

        .btn-reduce {
            background: white;
            color: var(--main-pink);
            border: 2px solid var(--main-pink);
            padding: 12px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
        }

        /* å…‘æ¢è®°å½• */
        .log-section {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .log-list {
            max-height: 250px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .log-item {
            font-size: 0.85rem;
            padding: 10px 0;
            border-bottom: 1px dashed #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .log-item:hover { background-color: #fff9fa; }

        .log-left { display: flex; flex-direction: column; gap: 4px; flex: 1; }
        .log-time { color: #bbb; font-size: 0.75rem; }
        
        /* å³ä¾§å°ç¼©ç•¥å›¾ */
        .log-right { display: flex; align-items: center; gap: 10px; }
        .thumb-preview {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: cover;
            border: 1px solid #eee;
            background: #f9f9f9;
        }

        /* è¯¦æƒ…å¼¹çª— */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 500px;
            border-radius: 25px;
            padding: 20px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            color: var(--dark-pink);
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .image-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .grid-img-wrap {
            aspect-ratio: 1;
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            background: #eee;
        }

        .grid-img-wrap img { width: 100%; height: 100%; object-fit: cover; }

        .btn-remove-img {
            position: absolute; top: 2px; right: 2px;
            background: rgba(0,0,0,0.5); color: white; border: none;
            border-radius: 50%; width: 18px; height: 18px; font-size: 10px;
        }

        .upload-btn {
            border: 2px dashed var(--main-pink);
            color: var(--main-pink);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            cursor: pointer;
        }

        .note-area {
            width: 100%;
            height: 80px;
            border: 1px solid #ffe0e6;
            border-radius: 10px;
            padding: 10px;
            box-sizing: border-box;
            font-family: inherit;
            margin-top: 10px;
            outline: none;
        }

        .modal-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .reward-card {
            background: white; border-radius: 20px; padding: 20px; margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); border-left: 8px solid var(--main-pink);
        }

        @keyframes floating { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    </style>
</head>
<body>

<div class="container">
    <div class="header-card">
        <span class="main-flower-img">ğŸŒ¸</span>
        <div class="title">æ·‡æ·‡ä¸åŠ ç›çš„å°çº¢èŠ±ä»“åº“</div>
        <div id="levelBadge" class="level-title">åˆçº§ä¹–ä¹–å®è´</div>
        <div class="flower-display">
            <div class="flower-count" id="totalCount">0</div>
            <div class="flower-unit">æœµå°çº¢èŠ±</div>
        </div>
        <div class="btn-group">
            <button class="btn-reduce" onclick="changeFlower(-1)">å‡å°‘ ğŸŒ¸ -1</button>
            <button class="btn-add" onclick="changeFlower(1)">ç‚¹å‡»è·å¾— ğŸŒ¸ +1</button>
        </div>
    </div>

    <div class="log-section">
        <div style="font-weight: bold; color: var(--dark-pink); display: flex; justify-content: space-between;">
            <span>ğŸ“œ å…‘æ¢è®°å½• <small style="font-weight: normal; font-size: 0.7rem; color: #999;">(ç‚¹å‡»å¯å­˜ç…§ç‰‡åŠæ–‡å­—)</small></span>
        </div>
        <div id="logList" class="log-list"></div>
    </div>

    <div class="reward-section-title" style="text-align: center; color: var(--dark-pink); margin: 30px 0 15px;">â€”â€” å¥–åŠ±å…‘æ¢åŒº â€”â€”</div>
    <div id="rewardContainer"></div>
</div>

<div id="detailModal" class="modal">
    <div class="modal-content">
        <div class="modal-header" id="modalTitle">é¡¹ç›®è¯¦æƒ…</div>
        <div class="image-grid" id="imageGrid">
            </div>
        <input type="file" id="fileInput" hidden multiple accept="image/*" onchange="handleFileUpload(event)">
        <div style="font-size: 0.8rem; color: #888;">ä¸Šä¼ ç…§ç‰‡è®°å½•ç”œèœœæ—¶åˆ»å§~</div>
        
        <textarea id="noteArea" class="note-area" placeholder="å†™ç‚¹ä»€ä¹ˆå§...æ¯”å¦‚é‚£å¤©çš„å¥¶èŒ¶å¥½ä¸å¥½å–ï¼Ÿ"></textarea>
        
        <div class="modal-footer">
            <button onclick="closeModal()" style="border:none; background:#eee; padding:8px 20px; border-radius:10px;">å–æ¶ˆ</button>
            <button onclick="saveDetail()" style="border:none; background:var(--dark-pink); color:white; padding:8px 20px; border-radius:10px;">ä¿å­˜è®°å½•</button>
        </div>
    </div>
</div>

<script>
    const rewardData = [
        { cost: 1, text: "ä¸€æ¬¡å°å¥–åŠ±ï¼å¯ä»¥è®©æ·‡æ·‡ç»™åŠ ç›å®è´ä¹°å¥½å–çš„å¥¶èŒ¶ï¼Œå¥½åƒçš„å°è›‹ç³•ï¼Œé¢åŒ…ç­‰ç­‰~" },
        { cost: 2, text: "æŒ‡å®šä¸€æ¬¡â€œä»Šå¤©ä½ è¯´äº†ç®—â€ï¼Œå¯ä»¥è®©æ·‡æ·‡ç»™åŠ ç›å®è´å®Œæˆä¸€ä»¶äº‹æƒ…ï¼Œä¸åšé™åˆ¶å“¦ï¼æˆ–è€…ä¹Ÿå¯ä»¥åœ¨çº¦ä¼šçš„æ—¶å€™å¯ä»¥æŒ‡å®šä¸€æ¬¡ä»Šå¤©å»å“ªåƒï¼Œæˆ–è€…ä»Šå¤©çœ‹ä»€ä¹ˆï¼Œæˆ–è€…æƒ³å»æŠ“å¨ƒå¨ƒå•Šï¼Œé€›ç¾é£Ÿè¡—å•Šï¼Œæƒ³çœ‹çš„ç”µå½±å•Šï¼Œä»¥åŠæŠ–éŸ³åˆ·åˆ°äº†æœ‰å¾ˆæƒ³å»çš„åº—ç„¶åæƒ³å«æ·‡æ·‡ä¸€èµ·å»æ‰“å¡å‘€ä¹‹ç±»çš„ï¼Œåªè¦å…‘æ¢ï¼Œè§é¢ä¸€å®šæ»¡è¶³~" },
        { cost: 5, text: "ä¸€æ¬¡å°ç¤¼ç‰©~åŒ…æ‹¬ä½†ä¸é™äºæƒ³è¦çš„ç©å¶ï¼Œæƒ…ä¾£å°ç¤¼ç‰©å‘€~ï¼ˆå¯¹æˆ’/æ‰‹ç»³/é’¥åŒ™æ‰£ï¼‰ä¹‹ç±»çš„" },
        { cost: 5, text: "ä¸€å¼ å…ç”Ÿæ°”å·ï¼å¦‚æœæ·‡æ·‡å› ä¸ºä¸€ä»¶äº‹ç”Ÿæ°”ï¼ŒåŠ ç›å®è´å¯ä»¥åœ¨åˆç†èŒƒå›´å†…ä½¿ç”¨æ­¤å·ï¼ŒéåŸåˆ™é—®é¢˜100%ç”Ÿæ•ˆ" },
        { cost: 5, text: "ä¸€å¼ é¢å¤–è§é¢å·ï¼Œå¦‚æœåŠ ç›å®è´å“ªå¤©ç‰¹åˆ«æƒ³æ·‡æ·‡ï¼Œç‰¹åˆ«æƒ³è§æˆ‘ï¼Œä½†æ˜¯è¿˜æ²¡åˆ°è§é¢æ—¥æœŸï¼Œå¯ä»¥ä½¿ç”¨æ­¤å·ï¼Œæ·‡æ·‡æ‰¿è¯ºä¼šåœ¨å¤„ç†å¥½äº‹æƒ…åï¼Œä»¥æœ€å¿«çš„é€Ÿåº¦å½“å¤©èµ¶åˆ°åŠ ç›å®è´èº«è¾¹" },
        { cost: 6, text: "æ·‡æ·‡äº²æ‰‹å‡†å¤‡çš„å°æƒŠå–œï¼ˆä¸å¯å…‘æ¢ï¼Œä½œä¸ºéšè—åŠŸèƒ½ï¼Œåœ¨æ»¡è¶³ä¸€å®šè¦æ±‚åè‡ªåŠ¨è§£é”ï¼‰", locked: true },
        { cost: 8, text: "æƒ…ä¾£ä¸“å±æŒ‘æˆ˜æˆ–å°æ¸¸æˆä¸€æ¬¡æŠ“å¨ƒå¨ƒæ¯”èµ›ï¼ˆè¾“çš„äººæœ‰æƒ©ç½šï¼‰æ¡Œæ¸¸/ç”µç©/å°æ¸¸æˆæƒ…ä¾£å°ä»»åŠ¡ ï¼ˆåŠ ç›å®è´æ‹¥æœ‰ä¸€å®šâ€œä½œå¼Šæƒâ€ï¼Œå˜¿å˜¿ï¼‰" },
        { cost: 10, text: "â€œä¸€æ•´å¤©å¥³å‹ç‰¹æƒæ—¥â€ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºå¥½æƒ³æ¥ä¹°å°é›¶é£Ÿï¼Œ1åˆ†é’Ÿï¼ŒåŠ ç›å®è´æŠ“åˆ°å¤šå°‘ä¹°å¤šå°‘é™æ—¶è´­ç‰©ï¼Œæ·‡æ·‡æŠ¥é”€æˆ–è€…ç¾é£Ÿè¡—æ‰€æœ‰æƒ³åƒçš„ï¼Œæƒ³åƒä»€ä¹ˆä¹°ä»€ä¹ˆï¼Œä¸ç”¨æ‹…å¿ƒæµªè´¹ï¼åœ¨è¿™ä¸€å¤©ï¼ŒåŠ ç›å®è´æ‰€æœ‰çš„è¦æ±‚æ·‡æ·‡éƒ½å°†å°½é‡æ»¡è¶³ï¼è€Œä¸”ä¼šä¿æŒè¶…é«˜æœåŠ¡æ€åº¦ï¼ä¸è¿‡é€›è¡—çš„æ—¶å€™åŠ ç›å®è´è¦æŒ½ç€èƒ³è†Šï¼Œå˜¿å˜¿ï¼ˆé™¤äº†æ‘˜æ˜Ÿæ˜Ÿè¿™ç§å®åœ¨ä¸å¤ªè¡Œï¼Œå˜¿å˜¿ï¼‰" },
        { cost: 10, text: "ä¸€ä¸ªä¸­ç­‰å¥–åŠ±ï¼Œè¿‘æœŸåŠ ç›å®è´è´­ç‰©è½¦éšæœºä¸€ä»¶ä¸­ç­‰èŒƒå›´å†…æŠ¥é”€!" },
        { cost: 10, text: "åŠ ç›å®è´ç‰¹åˆ«æƒ³è¦çš„åŒ–å¦†å“æˆ–è€…æŠ¤è‚¤å“ä¸€ä»¶" },
        { cost: 12, text: "ä¸“å±çºªå¿µæ—¥è‡ªå®šä¹‰\nåŠ ç›å®è´å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªæˆ‘ä»¬çš„å°çºªå¿µæ—¥ï¼Œæ·‡æ·‡éœ€åœ¨æ¯å¹´/æ¯æ¬¡è®¤çœŸå¯¹å¾…\nä¸å¯æ•·è¡ã€ä¸è®¸å¿˜è®°" },
        { cost: 15, text: "çº¦ä¼šé¢å¤–é¡¹ç›®ï¼Œå¦‚æ³¡æ¸©æ³‰å•Šï¼ŒçŸ­é€”å°æ—…è¡Œå•Š~ä¹‹ç±»çš„ï¼Œæœ‰å¾ˆå¤§çš„æ‰©å±•æ€§å“¦~å¯ä»¥è‡ªå·±æƒ³æƒ³ä¸€ä¸‹ï¼ˆç‰¹æ®Šæ·»åŠ ï¼šé‰´äºæ·‡æ·‡æœ€è¿‘åˆ·åˆ°ç¯çƒäº†æ„Ÿè§‰ç‰¹åˆ«å–œæ¬¢ï¼Œæ‰€ä»¥æ·»åŠ ä¸ŠåŒ—äº¬ç¯çƒå’Œè¿ªå£«å°¼ï¼Œä¸è¿‡è¿™ä¸¤ä¸ªå°çº¢èŠ±ä»·æ ¼è°ƒæ•´ä¸º20å“¦~å˜¿å˜¿ï¼‰" },
        { cost: 15, text: "åŠ ç›å®è´å¯ä»¥ç»™æ·‡æ·‡æä¸€ä¸ªç”Ÿæ´»æ–¹å¼æˆ–è€…ä¹ æƒ¯çš„è¦æ±‚ï¼æ·‡æ·‡ä¼šæ ¹æ®è¦æ±‚è¿›è¡Œè°ƒæ•´~" },
        { cost: 18, text: "ä¸€æ¬¡é«˜çº§æµªæ¼«çº¦ä¼šï¼æ¯”æ™®é€šçº¦ä¼šæ›´æ­£å¼ã€æ›´æœ‰ä»ªå¼æ„Ÿ" },
        { cost: 20, text: "ä¸€ä¸ªå¤§å¥–åŠ±ï¼Œéä»»ä½•èŠ‚æ—¥ä¹Ÿå¯ä»¥å…‘æ¢ï¼Œç»™åŠ ç›å®è´è´­ç‰©è½¦å†…éšæœºä¸€ä»¶æƒ³è¦çš„ä½†æ˜¯æ²¡èˆå¾—ä¹°çš„æ·‡æ·‡æŠ¥é”€ï¼æˆ–è€…å¯ä»¥å…‘æ¢ç‰©å“ï¼Œæ·‡æ·‡ç»™åŠ ç›å®è´ä¹°ï¼Œå¦‚æˆ‘æƒ³è¦ä¸ªæ‰‹é“¾ï¼Œæˆ‘æƒ³è¦ä¸ªé¦–é¥°ï¼Œæƒ³è¦ä¸ªæˆ’æŒ‡~ä¹‹ç±»çš„ï¼Œæˆ–è€…æœ‰å–œæ¬¢çš„è¡£æœä½†æ˜¯è¿˜æ²¡ä¹°çš„ï¼ŒæŠ¥é”€ï¼" },
        { cost: 30, text: "å®ç°åŠ ç›å®è´ä¸€ä¸ªå¿ƒæ„¿ï¼Œä¸åšé™åˆ¶ã€‚" }
    ];

    let count = parseInt(localStorage.getItem('flower_count')) || 0;
    let logs = JSON.parse(localStorage.getItem('flower_logs')) || [];
    let currentLogId = null;

    function init() {
        updateDisplay();
        renderLogs();
    }

    function changeFlower(amt) {
        if (count + amt < 0) return;
        count += amt;
        if (amt > 0) triggerConfetti();
        updateDisplay();
    }

    function updateDisplay() {
        document.getElementById('totalCount').innerText = count;
        localStorage.setItem('flower_count', count);
        const badge = document.getElementById('levelBadge');
        if (count <= 10) badge.innerText = "ğŸŒ± åˆçº§ä¹–ä¹–å®è´";
        else if (count <= 30) badge.innerText = "â­ æ¨¡èŒƒä¹–ä¹–å®è´";
        else badge.innerText = "ğŸŒŒ é“¶æ²³ç³»æœ€æœ€å¯çˆ±çš„åŠ ç›å®è´";
        renderRewards(); 
    }

    function renderRewards() {
        const container = document.getElementById('rewardContainer');
        container.innerHTML = rewardData.map((item, index) => `
            <div class="reward-card">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <span style="font-weight:bold; color:var(--dark-pink)">#${index+1}</span>
                    <span style="background:#fff0f3; color:var(--dark-pink); padding:2px 10px; border-radius:20px; font-size:0.8rem;">${item.cost} ğŸŒ¸</span>
                </div>
                <div style="font-size:0.9rem; color:#666;">${item.text}</div>
                <button class="btn-add" style="margin-top:10px; font-size:0.8rem; padding:5px 15px;" 
                        ${count < item.cost ? 'disabled style="filter:grayscale(1)"' : ''} 
                        onclick="redeem(${item.cost}, ${index+1})">ç«‹å³å…‘æ¢</button>
            </div>
        `).join('');
    }

    function redeem(cost, id) {
        if(confirm(`ç¡®å®šå…‘æ¢é¡¹ç›® #${id} å—ï¼Ÿ`)) {
            count -= cost;
            const logEntry = {
                id: Date.now(),
                time: new Date().toLocaleString(),
                content: `åŠ ç›å®è´å…‘æ¢äº†é¡¹ç›® #${id}`,
                images: [],
                note: ""
            };
            logs.unshift(logEntry);
            localStorage.setItem('flower_logs', JSON.stringify(logs));
            updateDisplay();
            renderLogs();
        }
    }

    function renderLogs() {
        const list = document.getElementById('logList');
        if (logs.length === 0) {
            list.innerHTML = '<div style="text-align:center; color:#ccc; padding:20px;">æš‚æ— è®°å½•</div>';
            return;
        }
        list.innerHTML = logs.map(item => `
            <div class="log-item" onclick="openDetail(${item.id})">
                <div class="log-left">
                    <span>${item.content}</span>
                    <span class="log-time">${item.time}</span>
                </div>
                <div class="log-right">
                    ${item.images.length > 0 ? `<img src="${item.images[0]}" class="thumb-preview">` : '<div class="thumb-preview" style="display:flex;align-items:center;justify-content:center;font-size:10px;color:#ddd">æ— å›¾</div>'}
                    <button onclick="event.stopPropagation(); deleteLog(${item.id})" style="border:none; background:none; color:#ffcbd1;">âœ•</button>
                </div>
            </div>
        `).join('');
    }

    function deleteLog(id) {
        if(confirm("ç¡®å®šåˆ é™¤è®°å½•å—ï¼Ÿ")) {
            logs = logs.filter(l => l.id !== id);
            localStorage.setItem('flower_logs', JSON.stringify(logs));
            renderLogs();
        }
    }

    /* å¼¹çª—é€»è¾‘ */
    function openDetail(id) {
        currentLogId = id;
        const log = logs.find(l => l.id === id);
        document.getElementById('modalTitle').innerText = log.content;
        document.getElementById('noteArea').value = log.note || "";
        renderImageGrid(log.images);
        document.getElementById('detailModal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('detailModal').style.display = 'none';
    }

    function renderImageGrid(images) {
        const grid = document.getElementById('imageGrid');
        let html = images.map((img, index) => `
            <div class="grid-img-wrap">
                <img src="${img}">
                <button class="btn-remove-img" onclick="removeImg(${index})">âœ•</button>
            </div>
        `).join('');
        
        if (images.length < 9) { // æœ€å¤šä¼ 9å¼ 
            html += `<div class="grid-img-wrap upload-btn" onclick="document.getElementById('fileInput').click()">+</div>`;
        }
        grid.innerHTML = html;
    }

    function handleFileUpload(e) {
        const files = Array.from(e.target.files);
        const log = logs.find(l => l.id === currentLogId);
        
        files.forEach(file => {
            const reader = new FileReader();
            reader.onload = (event) => {
                log.images.push(event.target.result);
                renderImageGrid(log.images);
            };
            reader.readAsDataURL(file);
        });
    }

    function removeImg(idx) {
        const log = logs.find(l => l.id === currentLogId);
        log.images.splice(idx, 1);
        renderImageGrid(log.images);
    }

    function saveDetail() {
        const log = logs.find(l => l.id === currentLogId);
        log.note = document.getElementById('noteArea').value;
        localStorage.setItem('flower_logs', JSON.stringify(logs));
        renderLogs();
        closeModal();
    }

    function triggerConfetti() {
        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, colors: ['#ffafbd', '#ff6b81', '#ffffff'] });
    }

    init();
</script>

</body>
</html>